<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SKI TRIP READINESS // 8-WEEK PROGRAM</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: { 
                            500: '#737373',
                            800: '#262626',
                            850: '#171717',
                            900: '#0a0a0a',
                            950: '#000000'
                        },
                        neon: { 400: '#d4d4d4', 500: '#ffffff', 600: '#a3a3a3', glow: 'rgba(255, 255, 255, 0.5)' },
                    },
                    fontFamily: {
                        'brand': ['"Black Ops One"', 'cursive'],
                        'mono': ['"JetBrains Mono"', 'monospace'],
                        'sans': ['Inter', 'sans-serif'],
                    },
                    boxShadow: {
                        'neon': '0 0 10px theme("colors.neon.glow")',
                    }
                }
            }
        }
    </script>

    <style>
        [x-cloak] { display: none !important; }
        body { 
            background-color: #000000; 
            color: #e5e5e5; 
        }
        
        /* Custom Scrollbar */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Modern Inputs */
        .input-tactical {
            background: transparent;
            border-bottom: 1px solid #404040;
            color: #fff;
            font-family: 'JetBrains Mono', monospace;
            text-align: center;
            transition: all 0.2s;
            border-radius: 0;
        }
        .input-tactical:focus {
            border-bottom-color: #ffffff;
            outline: none;
            background: rgba(255, 255, 255, 0.05);
        }
    </style>
</head>
<body x-data="workoutApp()" x-init="init()" class="min-h-screen flex flex-col font-sans selection:bg-neon-500 selection:text-black">

    <header class="fixed top-0 w-full z-50 bg-slate-950/80 backdrop-blur-md border-b border-slate-800/50 shadow-lg">
        <div class="max-w-3xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-neon-500/10 rounded flex items-center justify-center border border-neon-500/20">
                    <svg class="w-6 h-6 text-neon-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                </div>
                <div>
                    <h1 class="text-lg md:text-xl text-white font-brand tracking-wider leading-none">
                        SKI TRIP READINESS <span class="text-neon-500">WORKOUT PROGRAM</span>
                    </h1>
                    <div class="text-[9px] text-slate-500 font-mono uppercase tracking-widest">Zero Gear Required</div>
                </div>
            </div>
            
            <div class="text-right">
                <div class="text-[9px] text-slate-500 font-bold uppercase tracking-widest mb-1">Mission Progress</div>
                <div class="h-1.5 w-28 bg-slate-900 rounded-full overflow-hidden">
                    <div class="h-full bg-neon-500 shadow-[0_0_10px_rgba(59,130,246,0.5)] transition-all duration-700" :style="`width: ${calculateProgress()}%`"></div>
                </div>
            </div>
        </div>
    </header>

    <main class="flex-grow w-full max-w-3xl mx-auto px-4 pt-24 pb-12 space-y-8">

        <div class="space-y-6">
            <div>
                <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest ml-1 mb-2 block">Select Phase</label>
                <div class="flex overflow-x-auto gap-2 no-scrollbar pb-1">
                    <template x-for="w in 8">
                        <button 
                            @click="setWeek(w)"
                            class="flex-shrink-0 w-14 h-14 rounded-xl border flex flex-col items-center justify-center transition-all duration-200 relative overflow-hidden"
                            :class="currentWeek === w ? 'bg-neon-600 border-neon-500 text-white shadow-neon scale-105' : 'bg-slate-900 border-slate-800 text-slate-500 hover:border-slate-600'"
                        >
                            <div x-show="currentWeek === w" class="absolute inset-0 bg-gradient-to-b from-white/10 to-transparent"></div>
                            <span class="text-[9px] font-mono uppercase opacity-70">Wk</span>
                            <span class="text-xl font-brand leading-none" x-text="w"></span>
                        </button>
                    </template>
                </div>
            </div>

            <div>
                <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest ml-1 mb-2 block">Select Day</label>
                <div class="grid grid-cols-7 gap-1 md:gap-2">
                    <template x-for="d in 7">
                        <button 
                            @click="currentDay = d"
                            class="relative h-12 rounded-lg border flex items-center justify-center transition-all duration-200 font-mono text-sm font-bold"
                            :class="getDayClass(d)"
                        >
                            <span x-text="d"></span>
                            <div x-show="isDayStarted(currentWeek, d)" class="absolute top-1 right-1 w-1.5 h-1.5 rounded-full shadow-sm" :class="isDayComplete(currentWeek, d) ? 'bg-white shadow-[0_0_5px_rgba(255,255,255,0.8)]' : 'bg-slate-600'"></div>
                        </button>
                    </template>
                </div>
            </div>
        </div>

        <div class="bg-slate-900/50 backdrop-blur border-l-4 border-neon-500 p-6 rounded-r-xl shadow-lg">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h2 class="text-white font-brand text-2xl uppercase leading-none mb-1 tracking-wide" x-text="getDayTitle()"></h2>
                    <p class="text-neon-500 text-xs font-mono mb-3 tracking-wider" x-text="`WEEK ${currentWeek} // DAY ${currentDay}`"></p>
                </div>
                <div class="text-left md:text-right w-full md:w-auto flex md:block justify-between items-center border-t md:border-0 border-slate-800/50 pt-3 md:pt-0">
                    <div class="text-[10px] text-slate-500 font-mono uppercase">Status</div>
                    <div class="text-xs font-bold" :class="isDayComplete(currentWeek, currentDay) ? 'text-white' : 'text-slate-500'" x-text="isDayComplete(currentWeek, currentDay) ? 'COMPLETE' : 'IN PROGRESS'"></div>
                </div>
            </div>
            <p class="text-sm text-slate-300 italic border-t border-slate-800/50 pt-3 mt-3 md:mt-1" x-text="getDailyNote()"></p>
        </div>

        <div class="space-y-6" x-transition.opacity.duration.300ms>
            
            <template x-for="(ex, idx) in getCurrentExercises()" :key="idx">
                <div class="bg-slate-900/40 backdrop-blur-sm border border-slate-800/60 rounded-xl relative group hover:border-slate-700 transition-colors shadow-lg">
                    <!-- Header -->
                    <div class="p-4 flex justify-between items-start gap-4 bg-gradient-to-r from-slate-900/80 to-slate-900/40 rounded-t-xl">
                        <div class="flex gap-4 items-start w-full">
                            <div x-show="ex.code" class="flex-shrink-0 w-10 h-10 bg-slate-800 rounded-lg flex items-center justify-center border border-slate-700 shadow-inner">
                                <span class="text-xs font-mono font-bold text-neon-400" x-text="ex.code"></span>
                            </div>
                            <div class="flex-grow">
                                <div class="flex items-center gap-2">
                                    <h3 class="text-lg font-bold text-white leading-tight tracking-tight" x-text="ex.name"></h3>
                                    
                                    <!-- Info Icon Trigger -->
                                    <div class="relative flex items-center" x-data="{ showTooltip: false }" @mouseenter="showTooltip = true" @mouseleave="showTooltip = false">
                                        <svg class="w-4 h-4 text-slate-500 hover:text-white cursor-help transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        
                                        <!-- Tooltip -->
                                        <div x-show="showTooltip" 
                                             x-cloak
                                             x-transition:enter="transition ease-out duration-200"
                                             x-transition:enter-start="opacity-0 translate-y-2"
                                             x-transition:enter-end="opacity-100 translate-y-0"
                                             x-transition:leave="transition ease-in duration-150"
                                             x-transition:leave-start="opacity-100 translate-y-0"
                                             x-transition:leave-end="opacity-0 translate-y-2"
                                             class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-64 bg-slate-900 border border-slate-700 rounded-lg shadow-2xl z-50 overflow-hidden pointer-events-none">
                                            <img :src="getGifUrl(ex.name)" class="w-full h-48 object-cover bg-slate-800" alt="Exercise Demo">
                                            <div class="p-2 text-[10px] text-slate-400 bg-slate-950 text-center font-mono border-t border-slate-800">
                                                <span x-text="ex.name"></span> DEMO
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex flex-wrap gap-2 mt-2">
                                    <span class="text-[10px] font-bold text-slate-950 bg-neon-500 px-1.5 py-0.5 rounded-sm" x-text="ex.sets === 'Circuit' ? 'CIRCUIT' : ex.sets + ' SETS'"></span>
                                    <span class="text-[10px] font-mono text-slate-400 bg-slate-950/50 border border-slate-800 px-1.5 py-0.5 rounded-sm" x-text="'RIR: ' + ex.rir"></span>
                                    <button @click="startTimer(60)" class="text-[10px] text-slate-300 font-mono uppercase border border-slate-700 px-1.5 py-0.5 rounded-sm bg-slate-800 hover:bg-slate-700 hover:text-white transition-colors flex items-center gap-1 ml-auto md:ml-0">
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                        60s
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div x-show="ex.notes" class="px-4 pb-3">
                        <p class="text-xs text-slate-400 leading-relaxed bg-slate-950/30 p-2 rounded border-l-2 border-slate-700">
                            <span class="text-neon-500 font-bold mr-1">TIP:</span><span x-text="ex.notes"></span>
                        </p>
                    </div>

                    <div class="bg-slate-950/30 border-t border-slate-800/50 rounded-b-xl">
                        <div x-show="ex.type !== 'info'" class="grid gap-0">
                            <template x-for="s in parseSets(ex.sets)">
                                <div class="flex items-center gap-3 p-2 px-4 border-b border-slate-800/30 last:border-0 hover:bg-slate-800/20 transition-colors group/set">
                                    <div class="w-6 text-xs font-mono text-slate-600 text-center group-hover/set:text-slate-400 transition-colors" x-text="s"></div>
                                    
                                    <input type="text" 
                                        class="flex-1 bg-transparent border-b border-slate-800 text-sm text-center text-white focus:border-neon-500 focus:outline-none transition-colors py-1 font-mono placeholder-slate-700"
                                        placeholder="Log..."
                                        :value="getLog(currentWeek, currentDay, idx, s)"
                                        @input="saveLog(currentWeek, currentDay, idx, s, $event.target.value)"
                                    >

                                    <button 
                                        @click="toggleSet(currentWeek, currentDay, idx, s)"
                                        class="w-8 h-8 rounded-full flex items-center justify-center border transition-all duration-200"
                                        :class="isSetDone(currentWeek, currentDay, idx, s) ? 'bg-white border-white text-black shadow-neon scale-105' : 'bg-slate-900 border-slate-700 text-slate-600 hover:border-slate-500 hover:text-slate-400'"
                                    >
                                        <svg x-show="isSetDone(currentWeek, currentDay, idx, s)" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                                    </button>
                                </div>
                            </template>
                        </div>
                        
                        <div x-show="ex.type === 'info'" class="py-6 text-center">
                            <p class="text-slate-500 font-mono text-sm">Log completion above if applicable.</p>
                        </div>
                    </div>
                </div>
            </template>

            <div x-show="getCurrentExercises().length === 0" class="p-12 border-2 border-dashed border-slate-800 rounded-xl text-center bg-slate-900/20">
                <p class="text-slate-500 font-mono text-lg">REST DAY / NO DATA</p>
                <p class="text-slate-600 text-xs mt-2">Recover and prepare for the next mission.</p>
            </div>

        </div>

    </main>

    <footer class="bg-slate-950/80 backdrop-blur border-t border-slate-900 py-10 text-center mt-auto">
        <div class="max-w-2xl mx-auto px-4 space-y-8">
            
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-left">
                <div class="bg-slate-900/50 p-4 rounded-xl border border-slate-800/50 hover:border-slate-700 transition-colors">
                    <h4 class="text-neon-500 text-xs font-bold font-mono mb-2 uppercase tracking-wider">RIR (Reps In Reserve)</h4>
                    <p class="text-[10px] text-slate-400 leading-relaxed">How many more reps you could do with good form. "2 RIR" means stop 2 reps before failure.</p>
                </div>
                <div class="bg-slate-900/50 p-4 rounded-xl border border-slate-800/50 hover:border-slate-700 transition-colors">
                    <h4 class="text-neon-500 text-xs font-bold font-mono mb-2 uppercase tracking-wider">Tempo / Eccentric</h4>
                    <p class="text-[10px] text-slate-400 leading-relaxed">"Slower eccentric" means lower the weight slowly (3-4 seconds) to build control.</p>
                </div>
            </div>

            <div class="flex flex-col gap-6 pt-6 border-t border-slate-900/50">
                <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
                    <a href="https://buymeacoffee.com/charliem22u" target="_blank" class="text-xs text-slate-500 hover:text-white transition-colors flex items-center gap-2">
                        <span>☕</span> Support the Program
                    </a>
                    <button @click="resetData()" class="text-[10px] font-mono text-slate-600 hover:text-white border border-slate-800 hover:border-white px-3 py-1.5 rounded transition-all w-full sm:w-auto">
                        FACTORY RESET
                    </button>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <button @click="exportData()" class="text-[10px] font-mono bg-slate-900 text-slate-400 border border-slate-800 p-3 rounded-lg hover:text-white hover:border-slate-600 hover:bg-slate-800 transition-all flex items-center justify-center gap-2 group">
                        <svg class="w-4 h-4 group-hover:text-neon-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                        EXPORT DATA
                    </button>
                    <button @click="triggerImport()" class="text-[10px] font-mono bg-slate-900 text-slate-400 border border-slate-800 p-3 rounded-lg hover:text-white hover:border-slate-600 hover:bg-slate-800 transition-all flex items-center justify-center gap-2 group">
                        <svg class="w-4 h-4 group-hover:text-neon-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                        IMPORT DATA
                    </button>
                    <input type="file" id="importFile" class="hidden" accept=".json" @change="importData($event)">
                </div>
            </div>
        </div>
    </footer>

    <!-- Timer Overlay -->
    <div x-show="timer.active" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 translate-y-full"
         x-transition:enter-end="opacity-100 translate-y-0"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 translate-y-0"
         x-transition:leave-end="opacity-0 translate-y-full"
         class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[90%] max-w-md bg-slate-900/90 backdrop-blur-xl border border-neon-500/50 rounded-2xl p-4 z-50 shadow-[0_0_30px_rgba(59,130,246,0.3)] flex items-center justify-between ring-1 ring-white/10">
        <div class="flex items-center gap-4">
            <div class="relative">
                <div class="text-neon-500 font-mono text-3xl font-bold tracking-tighter" x-text="formatTime(timer.seconds)"></div>
                <div class="absolute -inset-4 bg-neon-500/20 blur-xl rounded-full -z-10 animate-pulse"></div>
            </div>
            <div class="text-[10px] text-slate-400 font-mono uppercase tracking-widest">Rest<br>Timer</div>
        </div>
        <div class="flex gap-2">
            <button @click="timer.seconds += 30" class="px-4 py-2 bg-slate-800 text-white text-xs font-mono rounded-lg border border-slate-700 hover:bg-slate-700 hover:border-slate-500 transition-colors active:scale-95">+30s</button>
            <button @click="stopTimer()" class="px-4 py-2 bg-red-500/10 text-red-400 text-xs font-mono rounded-lg border border-red-500/20 hover:bg-red-500/20 hover:text-red-300 transition-colors active:scale-95">STOP</button>
        </div>
    </div>

    <script>
        // FULL WORKOUT DATA FROM CSV
        const workoutData = {
            1: {
                note: "Start Here. 1 min rest between paired exercises (A1+A2, etc).",
                1: [
                    { code: "A1", name: "Wall Sit", sets: "2", rir: "5-10s Tank", notes: "90° angle at knee. Hands in the air!" },
                    { code: "A2", name: "Pushup", sets: "2", rir: "2-3 RIR", notes: "Feel free to do knee pushups" },
                    { code: "B1", name: "Single Leg Hip Thrust", sets: "2", rir: "2-3 RIR", notes: "Glute should be initiating the contraction" },
                    { code: "B2", name: "Bodyweight Row", sets: "2", rir: "2-3 RIR", notes: "Pull with elbows, not biceps. Can do one arm if too easy." },
                    { code: "C1", name: "Calf Raise", sets: "2", rir: "4 RIR", notes: "Slower eccentric (down) than concentric." },
                    { code: "C2", name: "Plank", sets: "2", rir: "5-10s Tank", notes: "Bum down, shoulders on top of elbows" }
                ],
                2: [{ type: "info", name: "Rest / Active", sets: "1", rir: "N/A", notes: "Rest - you might be sore! Get your steps up." }],
                3: [
                    { code: "A1", name: "Wall Sit", sets: "2", rir: "5-10s Tank", notes: "Hands in the air!" },
                    { code: "A2", name: "Pushup", sets: "2", rir: "2-3 RIR", notes: "Feel free to do knee pushups" },
                    { code: "B1", name: "Single Leg Hip Thrust", sets: "2", rir: "2-3 RIR", notes: "Glute initiates contraction" },
                    { code: "B2", name: "Bodyweight Row", sets: "2", rir: "2-3 RIR", notes: "Pull with elbows" },
                    { code: "C1", name: "Calf Raise", sets: "2", rir: "4 RIR", notes: "Slower eccentric" },
                    { code: "C2", name: "Plank", sets: "2", rir: "5-10s Tank", notes: "Shoulders on top of elbows" },
                    { code: "C3", name: "Single Leg Hip Thrust", sets: "2", rir: "2-3 RIR", notes: "Extra volume if needed" }
                ],
                4: [{ type: "info", name: "LISS Cardio", sets: "1", rir: "15-30m", notes: "Low intensity steady state (Cycling, Incline Walk, Row)." }],
                5: [
                    { code: "A1", name: "Wall Sit", sets: "2", rir: "5-10s Tank", notes: "" },
                    { code: "A2", name: "Pushup", sets: "2", rir: "2-3 RIR", notes: "" },
                    { code: "B1", name: "Squat", sets: "1", rir: "2-3 RIR", notes: "Elevate heels if needed." },
                    { code: "B2", name: "Bodyweight Row", sets: "2", rir: "2-3 RIR", notes: "" },
                    { code: "C1", name: "Calf Raise", sets: "2", rir: "4 RIR", notes: "" },
                    { code: "C2", name: "Plank", sets: "2", rir: "5-10s Tank", notes: "" }
                ],
                6: [{ type: "info", name: "Rest", sets: "1", rir: "N/A", notes: "Get your steps up." }],
                7: [{ type: "info", name: "LISS Cardio", sets: "1", rir: "15-30m", notes: "Low intensity steady state." }]
            },
            2: {
                note: "Novices Start Here. Volume increases.",
                1: [
                    { code: "A1", name: "Squats", sets: "2", rir: "2-3 RIR", notes: "Tight upper back, don't lock knees at top." },
                    { code: "A2", name: "Pushup", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "B1", name: "Single Leg Hip Thrust", sets: "3", rir: "2-3 RIR", notes: "Each leg" },
                    { code: "B2", name: "Bodyweight Row", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "C1", name: "Calf Raise", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "C2", name: "Plank", sets: "3", rir: "5-10s Tank", notes: "" },
                    { code: "C3", name: "Wall Sit", sets: "1", rir: "5-10s Tank", notes: "" }
                ],
                2: [{ type: "info", name: "Rest", sets: "1", rir: "N/A", notes: "Recovery." }],
                3: [
                    { code: "A1", name: "Squats", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "A2", name: "Pushup", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "B1", name: "Single Leg Hip Thrust", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "B2", name: "Bodyweight Row", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "C1", name: "Calf Raise", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "C2", name: "Plank", sets: "3", rir: "5-10s Tank", notes: "" },
                    { code: "C3", name: "Wall Sit", sets: "1", rir: "5-10s Tank", notes: "" }
                ],
                4: [{ type: "info", name: "LISS Cardio", sets: "1", rir: "15-30m", notes: "Low intensity." }],
                5: [
                    { code: "A1", name: "Squats", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "A2", name: "Pushup", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "B1", name: "Single Leg Hip Thrust", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "B2", name: "Bodyweight Row", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "C1", name: "Calf Raise", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "C2", name: "Plank", sets: "3", rir: "5-10s Tank", notes: "" },
                    { code: "C3", name: "Wall Sit", sets: "1", rir: "5-10s Tank", notes: "" }
                ],
                6: [{ type: "info", name: "Rest", sets: "1", rir: "N/A", notes: "Steps." }],
                7: [{ type: "info", name: "LISS Cardio", sets: "1", rir: "15-30m", notes: "Low intensity." }]
            },
            3: {
                note: "Intermediates Start Here. Reverse lunges introduced.",
                1: [
                    { code: "A1", name: "Squats", sets: "3", rir: "2-3 RIR", notes: "Slow down eccentric (down) phase." },
                    { code: "A2", name: "Pushup", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "B1", name: "Reverse Lunge", sets: "2", rir: "2-3 RIR", notes: "Back knee stops just above ground. Sets per leg." },
                    { code: "B2", name: "Bodyweight Row", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "C1", name: "Calf Raise", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "C2", name: "Plank", sets: "3", rir: "5-10s Tank", notes: "" },
                    { code: "C3", name: "Hamstring Bridge", sets: "2", rir: "5-10s Tank", notes: "Feet further away than normal." }
                ],
                2: [{ type: "info", name: "Rest", sets: "1", rir: "N/A", notes: "Recovery." }],
                3: [
                    { code: "A1", name: "Squats", sets: "3", rir: "2-3 RIR", notes: "Add backpack if reps getting high." },
                    { code: "A2", name: "Pushup", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "B1", name: "Reverse Lunge", sets: "2", rir: "2-3 RIR", notes: "" },
                    { code: "B2", name: "Bodyweight Row", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "C1", name: "Calf Raise", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "C2", name: "Plank", sets: "3", rir: "5-10s Tank", notes: "" },
                    { code: "C3", name: "Hamstring Bridge", sets: "2", rir: "5-10s Tank", notes: "" }
                ],
                4: [{ type: "info", name: "LISS Cardio", sets: "1", rir: "20-40m", notes: "Steady state." }],
                5: [
                    { code: "A1", name: "Squats", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "A2", name: "Pushup", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "B1", name: "Reverse Lunge", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "B2", name: "Bodyweight Row", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "C1", name: "Calf Raise", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "C2", name: "Plank", sets: "3", rir: "5-10s Tank", notes: "" },
                    { code: "C3", name: "Hamstring Bridge", sets: "3", rir: "5-10s Tank", notes: "" }
                ],
                6: [{ type: "info", name: "Rest", sets: "1", rir: "N/A", notes: "Steps." }],
                7: [{ type: "info", name: "LISS Cardio", sets: "1", rir: "20-40m", notes: "Steady state." }]
            },
            4: {
                note: "Depth Landings introduced. Focus on absorbing impact.",
                1: [
                    { code: "A1", name: "Squats", sets: "4", rir: "2-3 RIR", notes: "Add backpack if needed." },
                    { code: "A2", name: "Pushup", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "B1", name: "Depth Landing", sets: "1", rir: "4 Reps", notes: "Step off low chair, land on two feet absorbing impact." },
                    { code: "B2", name: "Bodyweight Row", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "C1", name: "Reverse Lunge", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "C2", name: "Calf Raise", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "D1", name: "Plank", sets: "3", rir: "5-10s Tank", notes: "" },
                    { code: "D2", name: "Hamstring Bridge", sets: "3", rir: "5-10s Tank", notes: "Move to 1 leg or extend legs further." }
                ],
                2: [{ type: "info", name: "Rest", sets: "1", rir: "N/A", notes: "Recovery." }],
                3: [
                    { code: "A1", name: "Squats", sets: "4", rir: "2-3 RIR", notes: "" },
                    { code: "A2", name: "Pushup", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "B1", name: "Depth Landing", sets: "1", rir: "4 Reps", notes: "" },
                    { code: "B2", name: "Bodyweight Row", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "C1", name: "Reverse Lunge", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "C2", name: "Calf Raise", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "D1", name: "Plank", sets: "3", rir: "5-10s Tank", notes: "" },
                    { code: "D2", name: "Hamstring Bridge", sets: "3", rir: "5-10s Tank", notes: "" }
                ],
                4: [{ type: "info", name: "LISS Cardio", sets: "1", rir: "20-40m", notes: "Steady state." }],
                5: [
                    { code: "A1", name: "Squats", sets: "4", rir: "2-3 RIR", notes: "" },
                    { code: "A2", name: "Pushup", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "B1", name: "Depth Landing", sets: "2", rir: "4 Reps", notes: "" },
                    { code: "B2", name: "Bodyweight Row", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "C1", name: "Reverse Lunge", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "C2", name: "Calf Raise", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "D1", name: "Plank", sets: "3", rir: "5-10s Tank", notes: "" },
                    { code: "D2", name: "Hamstring Bridge", sets: "3", rir: "5-10s Tank", notes: "" }
                ],
                6: [{ type: "info", name: "Rest", sets: "1", rir: "N/A", notes: "Steps." }],
                7: [{ type: "info", name: "LISS Cardio", sets: "1", rir: "20-40m", notes: "Steady state." }]
            },
            5: {
                note: "Day 3 is a CIRCUIT (0-10s rest between exercises). Day 6 is Intervals.",
                1: [
                    { code: "A1", name: "Pogo Hops", sets: "1", rir: "10 Reps", notes: "Small jumps, stiff ankles." },
                    { code: "B1", name: "Squats", sets: "4", rir: "2-3 RIR", notes: "" },
                    { code: "B2", name: "Pushup", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "C1", name: "Depth Landing", sets: "2", rir: "4 Reps", notes: "" },
                    { code: "C2", name: "Bodyweight Row", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "D1", name: "Split Squat", sets: "3", rir: "2-3 RIR", notes: "Rear foot on couch." },
                    { code: "D2", name: "Calf Raise", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "E1", name: "Hamstring Bridge/Walkout", sets: "3", rir: "5-10s Tank", notes: "" },
                    { code: "E2", name: "Tibialis Raises", sets: "3", rir: "2-3 RIR", notes: "Knees locked." },
                    { code: "E3", name: "Plank DB Pull Through", sets: "2", rir: "5-10s Tank", notes: "Drag object under torso." }
                ],
                2: [{ type: "info", name: "LISS Cardio", sets: "1", rir: "25-45m", notes: "Steady state." }],
                3: [
                    { name: "Squats", sets: "2", rir: "30s", notes: "Circuit Mode: 0-10s rest between exercises. 2 Rounds." },
                    { name: "Pushup", sets: "2", rir: "30s", notes: "" },
                    { name: "Bodyweight Row", sets: "2", rir: "30s", notes: "" },
                    { name: "Walking Lunge", sets: "2", rir: "30s", notes: "" },
                    { name: "Bench Dips", sets: "2", rir: "30s", notes: "" },
                    { name: "Prone YTWs", sets: "2", rir: "5-10s Tank", notes: "" },
                    { name: "SL Hip Thrust", sets: "2", rir: "2-3 RIR", notes: "" },
                    { name: "Tuck Crunches", sets: "2", rir: "5-10s Tank", notes: "Rest 1-2 mins after full round." }
                ],
                4: [{ type: "info", name: "Rest", sets: "1", rir: "N/A", notes: "Recovery." }],
                5: [
                    { code: "A1", name: "Pogo Hops", sets: "1", rir: "10 Reps", notes: "" },
                    { code: "B1", name: "Squats", sets: "4", rir: "2-3 RIR", notes: "" },
                    { code: "B2", name: "Pushup", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "C1", name: "Depth Landing", sets: "2", rir: "4 Reps", notes: "" },
                    { code: "C2", name: "Bodyweight Row", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "D1", name: "Split Squat", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "D2", name: "Calf Raise", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "E1", name: "Hamstring Bridge", sets: "3", rir: "5-10s Tank", notes: "" },
                    { code: "E2", name: "Tibialis Raises", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "E3", name: "Plank DB Pull Through", sets: "2", rir: "5-10s Tank", notes: "" }
                ],
                6: [{ type: "info", name: "Intervals", sets: "4", rir: "1m Hard / 2m Easy", notes: "Warmup 5m. 4 Rounds. Cooldown 5m." }],
                7: [{ type: "info", name: "Rest", sets: "1", rir: "N/A", notes: "Recovery." }]
            },
            6: {
                note: "Intensity Up. 3 Rounds of Circuit.",
                1: [
                    { code: "A1", name: "Single Leg RDL", sets: "1", rir: "5-10 Reps", notes: "Balance focus." },
                    { code: "A2", name: "Pogo Hops", sets: "1", rir: "10 Reps", notes: "" },
                    { code: "B1", name: "Squats", sets: "4", rir: "2-3 RIR", notes: "" },
                    { code: "B2", name: "Pushup", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "B3", name: "Depth Landing", sets: "2", rir: "4 Reps", notes: "" },
                    { code: "C1", name: "Bodyweight Row", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "C2", name: "Split Squat", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "C3", name: "Calf Raise", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "D1", name: "Hamstring Walkouts", sets: "3", rir: "5-10s Tank", notes: "" },
                    { code: "D2", name: "Tibialis Raises", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "D3", name: "Plank DB Pull Through", sets: "3", rir: "5-10s Tank", notes: "" }
                ],
                2: [{ type: "info", name: "LISS Cardio", sets: "1", rir: "25-45m", notes: "Steady state." }],
                3: [
                    { name: "Squats", sets: "3", rir: "30s", notes: "Circuit: 3 Rounds Total." },
                    { name: "Pushup", sets: "3", rir: "30s", notes: "" },
                    { name: "Bodyweight Row", sets: "3", rir: "30s", notes: "" },
                    { name: "Walking Lunge", sets: "3", rir: "30s", notes: "" },
                    { name: "Bench Dips", sets: "3", rir: "30s", notes: "" },
                    { name: "Prone YTWs", sets: "3", rir: "5-10s Tank", notes: "" },
                    { name: "SL Hip Thrust", sets: "3", rir: "2-3 RIR", notes: "" },
                    { name: "Tuck Crunches", sets: "3", rir: "5-10s Tank", notes: "" }
                ],
                4: [{ type: "info", name: "Rest", sets: "1", rir: "N/A", notes: "Recovery." }],
                5: [
                    { code: "A1", name: "Single Leg RDL", sets: "1", rir: "5-10 Reps", notes: "" },
                    { code: "A2", name: "Pogo Hops", sets: "1", rir: "10 Reps", notes: "" },
                    { code: "B1", name: "Squats", sets: "4", rir: "2-3 RIR", notes: "" },
                    { code: "B2", name: "Pushup", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "B3", name: "Depth Landing", sets: "2", rir: "4 Reps", notes: "" },
                    { code: "C1", name: "Bodyweight Row", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "C2", name: "Split Squat", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "C3", name: "Calf Raise", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "D1", name: "Hamstring Bridge", sets: "3", rir: "5-10s Tank", notes: "" },
                    { code: "D2", name: "Tibialis Raises", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "D3", name: "Plank Pull Through", sets: "3", rir: "5-10s Tank", notes: "" }
                ],
                6: [{ type: "info", name: "Intervals", sets: "5", rir: "1m Hard / 2m Easy", notes: "5 Rounds." }],
                7: [{ type: "info", name: "Rest", sets: "1", rir: "N/A", notes: "Recovery." }]
            },
            7: {
                note: "Plyometrics Introduced.",
                1: [
                    { code: "A1", name: "Single Leg RDL", sets: "2", rir: "5-10 Reps", notes: "Barefoot on towel for challenge!" },
                    { code: "A2", name: "Pogo Hops", sets: "2", rir: "10 Reps", notes: "Multi-directional (fwd/back/left/right)" },
                    { code: "B1", name: "Squats", sets: "5", rir: "2-3 RIR", notes: "Pistol squats if getting too strong." },
                    { code: "B2", name: "Pushup", sets: "2", rir: "2-3 RIR", notes: "" },
                    { code: "B3", name: "Bodyweight Row", sets: "2", rir: "2-3 RIR", notes: "" },
                    { code: "C1", name: "Alt Jump Lunges", sets: "2", rir: "4 RIR", notes: "Soft landings." },
                    { code: "C2", name: "Calf Raise", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "D1", name: "Hamstring Walkouts", sets: "3", rir: "5-10s Tank", notes: "" },
                    { code: "D2", name: "Tibialis Raises", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "D3", name: "Plank Pull Through", sets: "3", rir: "5-10s Tank", notes: "" },
                    { code: "OPT", name: "1-Leg Wall Sit", sets: "1", rir: "5-10s Tank", notes: "Throwback." }
                ],
                2: [{ type: "info", name: "LISS Cardio", sets: "1", rir: "30-60m", notes: "Steady state." }],
                3: [
                    { name: "Skater Jumps", sets: "3", rir: "30s", notes: "Circuit: 3 Rounds Total." },
                    { name: "Squat Pulses", sets: "3", rir: "30s", notes: "" },
                    { name: "Bodyweight Row", sets: "3", rir: "30s", notes: "" },
                    { name: "Pushup Burpees", sets: "3", rir: "30s", notes: "" },
                    { name: "Split Squat", sets: "3", rir: "2-3 RIR", notes: "" },
                    { name: "Bench Dips", sets: "3", rir: "30s", notes: "" },
                    { name: "Prone YTWs", sets: "3", rir: "5-10s Tank", notes: "" },
                    { name: "SL Hip Thrust", sets: "3", rir: "2-3 RIR", notes: "" },
                    { name: "Russian Twists", sets: "3", rir: "5-10s Tank", notes: "" },
                    { name: "Wall Sit", sets: "3", rir: "5-10s Tank", notes: "Rest 2 mins after round." }
                ],
                4: [{ type: "info", name: "Rest", sets: "1", rir: "N/A", notes: "Recovery." }],
                5: [
                    { code: "A1", name: "Single Leg RDL", sets: "2", rir: "5-10 Reps", notes: "" },
                    { code: "A2", name: "Pogo Hops", sets: "2", rir: "10 Reps", notes: "" },
                    { code: "B1", name: "Squats", sets: "5", rir: "2-3 RIR", notes: "" },
                    { code: "B2", name: "Pushup", sets: "2", rir: "2-3 RIR", notes: "" },
                    { code: "B3", name: "Bodyweight Row", sets: "2", rir: "2-3 RIR", notes: "" },
                    { code: "C1", name: "Alt Jump Lunges", sets: "2", rir: "4 RIR", notes: "" },
                    { code: "C2", name: "Calf Raise", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "D1", name: "Hamstring Walkouts", sets: "3", rir: "5-10s Tank", notes: "" },
                    { code: "D2", name: "Tibialis Raises", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "D3", name: "Plank Pull Through", sets: "3", rir: "5-10s Tank", notes: "" },
                    { code: "OPT", name: "1-Leg Wall Sit", sets: "1", rir: "5-10s Tank", notes: "" }
                ],
                6: [{ type: "info", name: "Intervals", sets: "6", rir: "1m Hard / 2m Easy", notes: "6 Rounds." }],
                7: [{ type: "info", name: "Rest", sets: "1", rir: "N/A", notes: "Recovery." }]
            },
            8: {
                note: "Final Week. Empty the tank.",
                1: [
                    { code: "A1", name: "Single Leg RDL", sets: "2", rir: "5-10 Reps", notes: "" },
                    { code: "A2", name: "Pogo Hops", sets: "2", rir: "10 Reps", notes: "" },
                    { code: "B1", name: "Squats", sets: "5", rir: "2-3 RIR", notes: "" },
                    { code: "B2", name: "Pushup", sets: "2", rir: "2-3 RIR", notes: "" },
                    { code: "B3", name: "Bodyweight Row", sets: "2", rir: "2-3 RIR", notes: "" },
                    { code: "C1", name: "Alt Jump Lunges", sets: "3", rir: "4 RIR", notes: "Extra volume." },
                    { code: "C2", name: "Tibialis Raises", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "D1", name: "Hamstring Walkouts", sets: "3", rir: "5-10s Tank", notes: "" },
                    { code: "D2", name: "Calf Raise", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "D3", name: "Plank Pull Through", sets: "3", rir: "5-10s Tank", notes: "" },
                    { code: "OPT", name: "1-Leg Wall Sit", sets: "1", rir: "5-10s Tank", notes: "Don't cheat!" }
                ],
                2: [{ type: "info", name: "LISS Cardio", sets: "1", rir: "30-60m", notes: "Steady state." }],
                3: [
                    { name: "Skater Jumps", sets: "3", rir: "30s", notes: "Circuit: 3 Rounds." },
                    { name: "Squat Pulses", sets: "3", rir: "30s", notes: "" },
                    { name: "Bodyweight Row", sets: "3", rir: "30s", notes: "" },
                    { name: "Pushup Burpees", sets: "3", rir: "30s", notes: "" },
                    { name: "Split Squat", sets: "3", rir: "2-3 RIR", notes: "" },
                    { name: "Bench Dips", sets: "3", rir: "30s", notes: "" },
                    { name: "Prone YTWs", sets: "3", rir: "5-10s Tank", notes: "" },
                    { name: "SL Hip Thrust", sets: "3", rir: "2-3 RIR", notes: "" },
                    { name: "Russian Twists", sets: "3", rir: "5-10s Tank", notes: "" },
                    { name: "Wall Sit", sets: "3", rir: "5-10s Tank", notes: "Rest 2 mins after round." }
                ],
                4: [{ type: "info", name: "Rest", sets: "1", rir: "N/A", notes: "Recovery." }],
                5: [
                    { code: "A1", name: "Single Leg RDL", sets: "2", rir: "5-10 Reps", notes: "" },
                    { code: "A2", name: "Pogo Hops", sets: "2", rir: "10 Reps", notes: "" },
                    { code: "B1", name: "Squats", sets: "5", rir: "2-3 RIR", notes: "" },
                    { code: "B2", name: "Pushup", sets: "2", rir: "2-3 RIR", notes: "" },
                    { code: "B3", name: "Bodyweight Row", sets: "2", rir: "2-3 RIR", notes: "" },
                    { code: "C1", name: "Alt Jump Lunges", sets: "3", rir: "4 RIR", notes: "" },
                    { code: "C2", name: "Tibialis Raises", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "D1", name: "Hamstring Walkouts", sets: "3", rir: "5-10s Tank", notes: "" },
                    { code: "D2", name: "Calf Raise", sets: "3", rir: "2-3 RIR", notes: "" },
                    { code: "D3", name: "Plank Pull Through", sets: "3", rir: "5-10s Tank", notes: "" },
                    { code: "OPT", name: "1-Leg Wall Sit", sets: "1", rir: "5-10s Tank", notes: "Finish Strong." }
                ],
                6: [{ type: "info", name: "Intervals", sets: "7", rir: "1m Hard / 2m Easy", notes: "7 Rounds." }],
                7: [{ type: "info", name: "Rest", sets: "1", rir: "N/A", notes: "PROGRAM COMPLETE." }]
            }
        };

        function workoutApp() {
            return {
                currentWeek: 1,
                currentDay: 1,
                logs: {},
                completedSets: {},
                timer: { seconds: 0, active: false, interval: null, initial: 0 },

                init() {
                    const savedWeek = localStorage.getItem('ep_week');
                    const savedDay = localStorage.getItem('ep_day');
                    if (savedWeek) this.currentWeek = parseInt(savedWeek);
                    if (savedDay) this.currentDay = parseInt(savedDay);
                    
                    this.logs = JSON.parse(localStorage.getItem('ep_logs')) || {};
                    this.completedSets = JSON.parse(localStorage.getItem('ep_completed')) || {};

                    this.$watch('currentWeek', val => localStorage.setItem('ep_week', val));
                    this.$watch('currentDay', val => localStorage.setItem('ep_day', val));
                },

                setWeek(w) {
                    this.currentWeek = w;
                    this.currentDay = 1;
                },

                getGifUrl(name) {
                    const gifLibrary = {
                        "Wall Sit": "https://media1.tenor.com/m/qMWYCRMCZjcAAAAd/wall-sit.gif",
                        "Pushup": "https://media.tenor.com/uPAgzN8lEHYAAAAj/push-up-pompe.gif",
                        "Single Leg Hip Thrust": "https://media1.tenor.com/m/a_1YJj1_1YJj1_/glute-bridge-one-leg.gif", 
                        "Bodyweight Row": "https://media1.tenor.com/m/1YJj1_1YJj1_/inverted-row.gif",
                        "Calf Raise": "https://media1.tenor.com/m/1YJj1_1YJj1_/calf-raises.gif",
                        "Plank": "https://media1.tenor.com/m/6SOetkNbfakAAAAd/plank-abs.gif",
                        "Squat": "https://media1.tenor.com/m/ggR8tS7tK7AAAAAd/squat-workout.gif",
                        "Squats": "https://media1.tenor.com/m/ggR8tS7tK7AAAAAd/squat-workout.gif",
                        "Reverse Lunge": "https://media1.tenor.com/m/1YJj1_1YJj1_/reverse-lunge.gif",
                        "Hamstring Bridge": "https://media1.tenor.com/m/1YJj1_1YJj1_/glute-bridge.gif",
                        "Depth Landing": "https://media1.tenor.com/m/1YJj1_1YJj1_/depth-jump.gif",
                        "Pogo Hops": "https://media1.tenor.com/m/1YJj1_1YJj1_/pogo-hops.gif",
                        "Split Squat": "https://media1.tenor.com/m/1YJj1_1YJj1_/split-squat.gif",
                        "Tibialis Raises": "https://media1.tenor.com/m/1YJj1_1YJj1_/tibialis-raise.gif",
                        "Plank Pull Through": "https://media1.tenor.com/m/1YJj1_1YJj1_/plank-pull-through.gif",
                        "Plank DB Pull Through": "https://media1.tenor.com/m/1YJj1_1YJj1_/plank-pull-through.gif",
                        "Walking Lunge": "https://media1.tenor.com/m/1YJj1_1YJj1_/walking-lunge.gif",
                        "Bench Dips": "https://media1.tenor.com/m/1YJj1_1YJj1_/bench-dips.gif",
                        "Prone YTWs": "https://media1.tenor.com/m/1YJj1_1YJj1_/ytw-exercise.gif",
                        "Tuck Crunches": "https://media1.tenor.com/m/1YJj1_1YJj1_/tuck-crunch.gif",
                        "Single Leg RDL": "https://media1.tenor.com/m/1YJj1_1YJj1_/single-leg-deadlift.gif",
                        "Hamstring Walkouts": "https://media1.tenor.com/m/1YJj1_1YJj1_/hamstring-walkout.gif",
                        "Alt Jump Lunges": "https://media1.tenor.com/m/1YJj1_1YJj1_/jumping-lunge.gif",
                        "1-Leg Wall Sit": "https://media1.tenor.com/m/1YJj1_1YJj1_/single-leg-wall-sit.gif",
                        "Skater Jumps": "https://media1.tenor.com/m/1YJj1_1YJj1_/skater-jump.gif",
                        "Squat Pulses": "https://media1.tenor.com/m/1YJj1_1YJj1_/squat-pulse.gif",
                        "Pushup Burpees": "https://media1.tenor.com/m/Mr2cT0nEuKwAAAAd/work-out-exercise.gif",
                        "Russian Twists": "https://media1.tenor.com/m/1YJj1_1YJj1_/russian-twist.gif"
                    };
                    
                    // Use the library URL if available, otherwise fallback to the placeholder
                    // Note: Some of these Tenor links are best-guess placeholders. 
                    // For a production app, you would host these files locally.
                    return gifLibrary[name] || `https://placehold.co/400x300/171717/FFF?text=${encodeURIComponent(name)}`;
                },

                getCurrentExercises() {
                    return workoutData[this.currentWeek][this.currentDay] || [];
                },

                getDailyNote() {
                    return workoutData[this.currentWeek].note || "Focus on form and intensity.";
                },

                getDayTitle() {
                    if (this.currentWeek >= 5 && this.currentDay === 3) return "Circuit Breaker";
                    const exs = this.getCurrentExercises();
                    if (exs.length > 0 && exs[0].type === 'info') return exs[0].name.toUpperCase();
                    return "Strength Protocol";
                },

                getDayClass(d) {
                    if (this.currentDay === d) return "bg-slate-800 border-neon-500 text-white shadow-[0_0_10px_rgba(59,130,246,0.3)]";
                    if (this.isDayComplete(this.currentWeek, d)) return "bg-slate-900 border-slate-800 text-green-500";
                    if (this.isDayStarted(this.currentWeek, d)) return "bg-slate-900 border-slate-800 text-neon-500";
                    return "bg-slate-950 border-slate-800 text-slate-500 hover:border-slate-600";
                },

                parseSets(val) {
                    if (typeof val === 'number') return val;
                    if (val === 'Circuit') return 1;
                    if (val.includes('-')) return parseInt(val.split('-')[1]);
                    return parseInt(val) || 1;
                },

                getLogKey(w, d, exIdx, setIdx) {
                    return `w${w}-d${d}-ex${exIdx}-s${setIdx}`;
                },

                getLog(w, d, exIdx, setIdx) {
                    return this.logs[this.getLogKey(w, d, exIdx, setIdx)] || '';
                },

                saveLog(w, d, exIdx, setIdx, val) {
                    const key = this.getLogKey(w, d, exIdx, setIdx);
                    this.logs[key] = val;
                    localStorage.setItem('ep_logs', JSON.stringify(this.logs));
                    if (val.length > 0 && !this.completedSets[key]) {
                        this.toggleSet(w, d, exIdx, setIdx);
                    }
                },

                isSetDone(w, d, exIdx, setIdx) {
                    return !!this.completedSets[this.getLogKey(w, d, exIdx, setIdx)];
                },

                toggleSet(w, d, exIdx, setIdx) {
                    const key = this.getLogKey(w, d, exIdx, setIdx);
                    if (this.completedSets[key]) delete this.completedSets[key];
                    else this.completedSets[key] = true;
                    localStorage.setItem('ep_completed', JSON.stringify(this.completedSets));
                },

                isDayStarted(w, d) {
                    const prefix = `w${w}-d${d}-`;
                    return Object.keys(this.completedSets).some(k => k.startsWith(prefix));
                },

                getTotalSetsForDay(w, d) {
                    const exercises = workoutData[w]?.[d] || [];
                    let total = 0;
                    exercises.forEach(ex => {
                        if (ex.type === 'info') return;
                        total += this.parseSets(ex.sets);
                    });
                    return total;
                },

                isDayComplete(w, d) {
                    const totalNeeded = this.getTotalSetsForDay(w, d);
                    if (totalNeeded === 0) return false;
                    const prefix = `w${w}-d${d}-`;
                    const completed = Object.keys(this.completedSets).filter(k => k.startsWith(prefix)).length;
                    return completed >= totalNeeded;
                },

                getTotalSetsInProgram() {
                    let total = 0;
                    for (const w in workoutData) {
                        if (w === 'note') continue;
                        for (const d in workoutData[w]) {
                            if (d === 'note') continue;
                            const exercises = workoutData[w][d];
                            if (!Array.isArray(exercises)) continue;
                            exercises.forEach(ex => {
                                if (ex.type === 'info') return;
                                total += this.parseSets(ex.sets);
                            });
                        }
                    }
                    return total || 1;
                },

                calculateProgress() {
                    const totalSets = this.getTotalSetsInProgram();
                    const completed = Object.keys(this.completedSets).length;
                    return Math.min(100, Math.round((completed / totalSets) * 100));
                },

                // Timer
                startTimer(sec) {
                    this.stopTimer();
                    this.timer.initial = sec;
                    this.timer.seconds = sec;
                    this.timer.active = true;
                    this.timer.interval = setInterval(() => {
                        this.timer.seconds--;
                        if (this.timer.seconds <= 0) {
                            this.stopTimer();
                            if (navigator.vibrate) navigator.vibrate([200, 100, 200]);
                        }
                    }, 1000);
                },
                stopTimer() {
                    if (this.timer.interval) clearInterval(this.timer.interval);
                    this.timer.active = false;
                    this.timer.interval = null;
                },
                formatTime(sec) {
                    const m = Math.floor(sec / 60);
                    const s = sec % 60;
                    return `${m}:${s.toString().padStart(2, '0')}`;
                },

                // Data Management
                exportData() {
                    const data = {
                        logs: this.logs,
                        completed: this.completedSets,
                        week: this.currentWeek,
                        day: this.currentDay,
                        timestamp: new Date().toISOString()
                    };
                    const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `emergency-protocol-backup-${new Date().toISOString().slice(0,10)}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                },

                triggerImport() {
                    document.getElementById('importFile').click();
                },

                importData(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (data.logs && data.completed) {
                                if(confirm('Overwrite current data with imported data?')) {
                                    this.logs = data.logs;
                                    this.completedSets = data.completed;
                                    if (data.week) this.currentWeek = data.week;
                                    if (data.day) this.currentDay = data.day;
                                    localStorage.setItem('ep_logs', JSON.stringify(this.logs));
                                    localStorage.setItem('ep_completed', JSON.stringify(this.completedSets));
                                    localStorage.setItem('ep_week', this.currentWeek);
                                    localStorage.setItem('ep_day', this.currentDay);
                                    alert('Import successful!');
                                }
                            } else {
                                alert('Invalid file format.');
                            }
                        } catch (err) {
                            alert('Error reading file.');
                        }
                    };
                    reader.readAsText(file);
                },

                resetData() {
                    if (confirm("FACTORY RESET: This will wipe all your tracked data. Continue?")) {
                        localStorage.clear();
                        window.location.reload();
                    }
                }
            }
        }
    </script>
</body>
</html>